<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link 
    rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" 
    integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" 
    crossorigin="anonymous" 
    referrerpolicy="no-referrer" 
  />
  <link href="/css/main.css" rel="stylesheet">
  <title>TinyRoute - URL Shortener</title>
</head>
<body>
  <!-- Navbar -->
  <header>
    <nav class="navbar container">
      <h1 class="logo"><i class="fa-solid fa-link"></i> TinyRoute</h1>
      <ul class="nav-links">
        <% if (user) { %>
          <li><a href="/dashboard"><i class="fa-solid fa-chart-line"></i> Dashboard</a></li>
          <li><a href="/logout"><i class="fa-solid fa-right-from-bracket"></i> Logout</a></li>
        <% } else { %>
          <li><a href="/login"><i class="fa-solid fa-right-to-bracket"></i> Login</a></li>
          <li><a href="/register"><i class="fa-solid fa-user-plus"></i> Sign Up</a></li>
        <% } %>
      </ul>
    </nav>
  </header>

  <!-- Hero Section -->
  <section class="hero">
    <div class="hero-content">
      <h2>Shorten Your Links Instantly</h2>
      <p>Make your URLs clean, shareable, and memorable with TinyRoute.</p>
      <form action="/shorten" method="POST" class="url-form">
        <input type="url" name="originalUrl" placeholder="Paste your long URL here..." required>
        <button id="BtnShortener" type="submit">
          <i class="fa-solid fa-scissors"></i> Shorten
        </button>
      </form>
    </div>
  </section>

  <!-- URL Display Section -->
  <section class="urls-section">
    <div class="container">
      <% if (shortUrls && shortUrls.length > 0) { %>
        <div class="urls-header">
          <h3><i class="fa-solid fa-clock-rotate-left"></i> Your Shortened URLs</h3>
          <span class="url-count"><%= shortUrls.length %> link<%= shortUrls.length !== 1 ? 's' : '' %></span>
        </div>

        <div class="urls-grid">
          <% shortUrls.forEach(url => { %>
            <div class="url-card">
              <div class="url-card-header">
                <div class="url-favicon">
                  <% 
                    let favicon = '';
                    let domain = '';
                    try {
                      const urlObj = new URL(url.originalUrl);
                      domain = urlObj.hostname.replace('www.', '');
                      favicon = `https://www.google.com/s2/favicons?domain=${urlObj.hostname}&sz=32`;
                    } catch(e) {
                      domain = 'Invalid URL';
                    }
                  %>
                  <% if (favicon) { %>
                    <img src="<%= favicon %>" alt="<%= domain %>" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <i class="fa-solid fa-link" style="display:none;"></i>
                  <% } else { %>
                    <i class="fa-solid fa-link"></i>
                  <% } %>
                </div>
              </div>

              <!-- Card Body -->
              <div class="url-card-body">
                <!-- Short URL -->
                <div class="url-section">
                  <label>Short URL</label>
                  <a href="/<%= url.shortCode %>" target="_blank" class="short-url">
                    <%= req.protocol %>://<%= req.get('host') %>/<%= url.shortCode %>
                  </a>
                </div>

                <!-- Original URL -->
                <div class="url-section">
                  <label>Original URL</label>
                  <p class="original-url" title="<%= url.originalUrl %>">
                    <%= url.originalUrl %>
                  </p>
                </div>

                <!-- Meta Info -->
                <div class="url-meta">
                  <span class="date">
                    <i class="fa-solid fa-calendar"></i>
                    <%= new Date(url.createdAt).toLocaleDateString('en-US', { 
                      month: 'short', 
                      day: 'numeric', 
                      year: 'numeric' 
                    }) %>
                  </span>
                </div>
              </div>
            </div>
          <% }) %>
        </div>

      <% } else { %>
        <!-- No URLs - show empty state -->
        <div class="empty-state">
          <div class="empty-icon">
            <i class="fa-solid fa-link-slash"></i>
          </div>
          <h3>No URLs Yet</h3>
          <p>Start by shortening your first URL above!</p>
        </div>
      <% } %>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="container">
      <p>&copy; TinyRoute <%= new Date().getFullYear() %>. All rights reserved.</p>
      <div class="socials">
        <a href="https://www.linkedin.com/in/mohodejimi/" target="_blank" title="LinkedIn">
          <i class="fa-brands fa-linkedin"></i>
        </a>
        <a href="https://github.com/MohOdejimi" target="_blank" title="GitHub">
          <i class="fa-brands fa-github"></i>
        </a>
        <a href="https://twitter.com/MohOdejimi" target="_blank" title="Twitter">
          <i class="fa-brands fa-x-twitter"></i>
        </a>
      </div>
    </div>
  </footer>
  <script src="/js/client.js"></script>
</body>
</html>